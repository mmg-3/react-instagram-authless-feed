{"version":3,"sources":["lib/Instagram.js","components/Media.js","components/Feed.js","index.js"],"names":["Instagram","userName","fetchWithRetry","n","err","fetch","Math","random","then","resp","text","body","data","split","JSON","parse","substr","length","Error","getJSON","json","url","node","shortcode","src","__typename","thumbnail_src","thumbnail_resources","forEach","item","index","config_width","thumbnailIndex","entry_data","ProfilePage","graphql","user","edge_owner_to_timeline_media","edges","map","edge","alt","edge_media_to_caption","accessibility_caption","mapMedia","catch","Media","href","this","props","rel","target","Component","Feed","state","loading","media","getFeedFn","setState","slice","limit","error","className","classNameLoading","join","key","defaultProps","getFeed","ErrorBoundary","hasError","errorInfo","children","React","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.7230f7af.chunk.js","sourcesContent":["class Instagram {\r\n  static getFeed(userName) {\r\n    const mapMedia = (json) => {\r\n      try {\r\n        const thumbnailIndex = (node) => {\r\n          node.thumbnail_resources.forEach((item, index) => {\r\n            if (item.config_width === 640) {\r\n              return index;\r\n            }\r\n          });\r\n\r\n          return 4; // MAGIC\r\n        };\r\n\r\n        const url = (node) => {\r\n          return \"https://www.instagram.com/p/\" + node.shortcode;\r\n        };\r\n\r\n        const src = (node) => {\r\n          switch (node.__typename) {\r\n            case \"GraphVideo\":\r\n              return node.thumbnail_src;\r\n            case \"GraphSidecar\":\r\n            default:\r\n              return node.thumbnail_resources[thumbnailIndex(node)].src;\r\n          }\r\n        };\r\n\r\n        const alt = (node) => {\r\n          if (\r\n            node.edge_media_to_caption.edges[0] &&\r\n            node.edge_media_to_caption.edges[0].node\r\n          ) {\r\n            return node.edge_media_to_caption.edges[0].node.text;\r\n          } else if (node.accessibility_caption) {\r\n            return node.accessibility_caption;\r\n          } else {\r\n            return \"\";\r\n          }\r\n        };\r\n\r\n        const edges =\r\n          json.entry_data.ProfilePage[0].graphql.user\r\n            .edge_owner_to_timeline_media.edges;\r\n\r\n        return edges.map((edge) => {\r\n          return {\r\n            alt: alt(edge.node),\r\n            url: url(edge.node),\r\n            src: src(edge.node),\r\n          };\r\n        });\r\n      } catch (err) {\r\n        throw Error(\"cannot map media array\");\r\n      }\r\n    };\r\n\r\n    const getJSON = (body) => {\r\n      try {\r\n        const data = body\r\n          .split(\"window._sharedData = \")[1]\r\n          .split(\"</script>\")[0];\r\n        return JSON.parse(data.substr(0, data.length - 1));\r\n      } catch (err) {\r\n        throw Error(\"cannot parse response body\");\r\n      }\r\n    };\r\n\r\n    const url = () => {\r\n      return (\r\n        \"https://images\" +\r\n        ~~(Math.random() * 3333) +\r\n        \"-focus-opensocial.googleusercontent.com/gadgets/proxy?container=none&url=https://www.instagram.com/\" +\r\n        userName +\r\n        \"/\"\r\n      );\r\n    };\r\n\r\n    const fetchWithRetry = (n, err) => {\r\n      if (n <= 1) throw err;\r\n\r\n      return fetch(url())\r\n        .then((resp) => resp.text())\r\n        .then((body) => getJSON(body))\r\n        .then((json) => mapMedia(json))\r\n        .catch((err) => fetchWithRetry(n - 1, err));\r\n    };\r\n\r\n    return fetchWithRetry(5);\r\n  }\r\n}\r\n\r\nexport default Instagram;\r\n","import React, { Component } from \"react\";\r\n\r\nclass Media extends Component {\r\n  render() {\r\n    return (\r\n      <a href={this.props.url} rel=\"noopener\" target=\"_blank\">\r\n        <img src={this.props.src} alt={this.props.alt}></img>\r\n      </a>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Media;\r\n","import React, { Component } from \"react\";\r\nimport Instagram from \"./../lib/Instagram\";\r\nimport Media from \"./Media\";\r\n\r\nclass Feed extends Component {\r\n  static defaultProps = {\r\n    className: \"\",\r\n    classNameLoading: \"\",\r\n    getFeedFn: Instagram.getFeed,\r\n    limit: 12,\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = { loading: true, media: [] };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props\r\n      .getFeedFn(this.props.userName)\r\n      .then((media) =>\r\n        this.setState({\r\n          loading: false,\r\n          media: media.slice(0, this.props.limit),\r\n        })\r\n      )\r\n      .catch((error) => this.setState({ error }));\r\n  }\r\n\r\n  render() {\r\n    if (this.state.error) throw this.state.error;\r\n\r\n    const className = this.state.loading\r\n      ? [this.props.className, this.props.classNameLoading].join(\" \")\r\n      : this.props.className;\r\n\r\n    return (\r\n      <div className={className}>\r\n        {this.state.media.map((media, index) => (\r\n          <Media key={index} src={media.src} url={media.url} alt={media.alt} />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Feed;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport Feed from \"./components/Feed\";\r\n\r\nclass ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = { hasError: false };\r\n  }\r\n\r\n  static getDerivedStateFromError(error) {\r\n    return { hasError: true };\r\n  }\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    // You can also log the error to an error reporting service\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return (\r\n        <div>\r\n          <h1>Something went wrong.</h1>\r\n          <p>\r\n            N.B. VPN/NAT source ip addresses can trigger Instagram rate limits.\r\n          </p>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nReactDOM.render(\r\n  <ErrorBoundary>\r\n    <Feed\r\n      userName=\"mindyhardy\"\r\n      className=\"Feed\"\r\n      classNameLoading=\"Loading\"\r\n      limit=\"3\"\r\n    />\r\n  </ErrorBoundary>,\r\n  document.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}